<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ティーヌ宅麻雀順位表</title>
<style>
table {
width: 50%;
border-collapse: collapse;
margin: 20px auto;
}
th, td {
border: 1px solid black;
padding: 8px;
text-align: left;
}
th {
background-color: #f2f2f2;
}
</style>
</head>
<body>
<script>
var today=new Date(); 
var year = today.getFullYear();
var month = today.getMonth()+1;
var week = today.getDay();
var day = today.getDate();
</script>
<h1>ティーヌ宅麻雀順位表</h1>
<p>更新日: <time id="modified_date"></time></p>
<script>
/**
  * ステップ1
  * ファイルの更新日を取得
  */
// HTMLファイルの最終更新日を取得
const last = new Date(document.lastModified);
/**
  * ステップ2
  * 取得した日付データを「年・月・日」に分けて取得
  */
// 取得した日付を「年・月・日」に分けて変数に格納する
const year = last.getFullYear();
const month = last.getMonth() + 1;
const date = last.getDate();
/**
  * ステップ3
  * 「月・日」の値が1桁の場合は先頭に「0」を追加して2桁に修正
  */
// 月・日の値を修正した後に格納する変数を用意する
let fixedMonth = month;
let fixedDate = date;
// 月の値が10より小さい場合は先頭に「0」を追加
if (month < 10) {
fixedMonth = "0" + month;
}
// 日の値が10より小さい場合は先頭に「0」を追加
if (date < 10) {
fixedDate = "0" + date;
}
/**
  * ステップ4
  * 上書き用の日付のテキストを作成
  */
// 表示用のテキストを作成 例: 2024年2月8日
const viewDateText = year + "年" + month + "月" + date + "日";
// データ用の文字列を作成 例: 2024-02-08
const datetimeText = year + "-" + fixedMonth + "-" + fixedDate;
/**
  * ステップ5
  * HTMLの要素に値を上書き
  */
// 更新日の表示先のHTML要素「time」タグを取得
const target = document.getElementById('modified_date');
// timeタグの内容を上書きする 例: 2024年2月8日
target.textContent = viewDateText;
// timeタグのdatetime属性を追加する 例: 2024-02-08
target.setAttribute("datetime", datetimeText);
</script>
<table id="rankings">
<tr>
<th>順位</th>
<th>名前</th>
<th>レート</th>
</tr>
</table>

<script>
// データを取得して順位表を作成する関数
function generateRankings() {
// データファイルのURL
var dataFile = "data.txt";

// 順位表のテーブル要素
var table = document.getElementById("rankings");

// データを取得
fetch(dataFile)
.then(response => response.text())
.then(data => {
// データを改行で分割し、各行を処理
data.trim().split('\n').map(line => {
var [name, rate] = line.split(':');
return { name, rate: parseInt(rate) };
}).sort((a, b) => b.rate - a.rate) // レートで降順ソート
.forEach((item, index) => {
var rank = index + 1;

// テーブルに行を追加
var row = table.insertRow();
row.insertCell(0).textContent = rank;
row.insertCell(1).textContent = item.name;
row.insertCell(2).textContent = item.rate;
});
});
}

// ページの読み込みが完了したら順位表を生成
window.onload = generateRankings;
</script>
</body>
</html>
